/* ---------------- RATINGS (FIXED) ----------------
 * Students create, students read their own, Admins read/manage all, and Counsellors read ratings about them.
 * ----------------------------------------*/
match /ratings/{ratingId} {
  // Student creates rating -> studentId must match their UID
  allow create: if request.auth != null
             && request.resource.data.studentId == request.auth.uid; 
  
  // ALLOW READ if: Admin OR Student created it OR Counsellor is the Person rated (personId)
  allow read: if request.auth != null
            && (request.auth.token.admin == true
             || resource.data.studentId == request.auth.uid
             || resource.data.personId == request.auth.uid); // <--- THIS IS THE NEW LINE
             
  // Only admin can modify or delete
  allow update, delete: if request.auth != null
                      && request.auth.token.admin == true;
}
